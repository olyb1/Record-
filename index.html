<!DOCTYPE html>
<html>
<head>
<title>My Own Score Record</title>
<style>
body { font-size: 18px; }
table { width: 90%; border-collapse: collapse; font-size: 16px; }
th, td { border: 1px solid black; padding: 12px; }
th { text-align: left; }
input[type="text"] { font-size: 16px; padding: 8px; width: 100%; box-sizing: border-box; }
button { font-size: 16px; padding: 8px 12px; }
img { max-width: 100px; max-height: 100px; }
</style>
</head>
<body>

<input type="text" id="searchInput" placeholder="Search..." onkeyup="searchTable()">

<table>
  <thead>
    <tr>
      <th>Assessment Name</th>
      <th>Score</th>
      <th>Image</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<input type="text" id="newCol1" placeholder="Assessment Name">
<input type="text" id="newCol2" placeholder="Score">
<button onclick="requestImage()">Choose Image</button>
<button onclick="addRow()">Add Row</button>

<script>
  let data = [];

  function loadData() {
    const storedData = Android.getWebViewString(); // Get data from MIT App Inventor
    if (storedData) {
      data = JSON.parse(storedData);
    }
    renderTable();
  }

  function updateData(rowIndex, colIndex, value) {
    data[rowIndex][colIndex] = value;
    saveData();
    renderTable();
  }

  function deleteRow(rowIndex) {
    data.splice(rowIndex, 1);
    saveData();
    renderTable();
  }

  function addRow() {
    const newRow = [
      document.getElementById('newCol1').value,
      document.getElementById('newCol2').value,
      selectedImage // Image selected from MIT App Inventor
    ];
    data.push(newRow);
    document.getElementById('newCol1').value = '';
    document.getElementById('newCol2').value = '';
    selectedImage = ''; // Reset image selection
    saveData();
    renderTable();
  }

  function saveData() {
    Android.setWebViewString(JSON.stringify(data)); // Save data in MIT App Inventor
  }

  function renderTable() {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filteredData = data.filter(row => row.some(cell => cell && cell.toString().toLowerCase().includes(searchTerm)));

    filteredData.forEach((row, rowIndex) => {
      const newRow = tbody.insertRow();
      row.forEach((cell, colIndex) => {
        const cellElement = newRow.insertCell();
        if (colIndex === 2) { // Image column
          const img = document.createElement('img');
          img.src = cell || '';
          img.alt = 'Uploaded Image';
          cellElement.appendChild(img);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.value = cell;
          input.addEventListener('change', () => updateData(rowIndex, colIndex, input.value));
          cellElement.appendChild(input);
        }
      });

      const actionsCell = newRow.insertCell();
      const deleteButton = document.createElement('button');
      deleteButton.textContent = 'Delete';
      deleteButton.onclick = () => deleteRow(rowIndex);
      actionsCell.appendChild(deleteButton);
    });
  }

  // Function to request image selection from MIT App Inventor
  let selectedImage = '';
  function requestImage() {
    Android.chooseImage(); // This will trigger MIT App Inventor to open a file picker
  }

  // Function to receive image from MIT App Inventor
  function receiveImage(imageUrl) {
    selectedImage = imageUrl;
  }

  loadData(); // Load data when the page loads
</script>

</body>
</html>
